# åœºæ™¯æ•°æ®é›†

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥ä¸‹è½½åœºæ™¯æ•°æ®é›†ï¼ˆé€šå¸¸æ˜¯ä»åŸå§‹æ•°æ®é›†æ”¹ç¼–è€Œæ¥ï¼‰ã€‚

ManiSkill å¯ä»¥æ„å»ºä»»ä½•åœºæ™¯ï¼Œåªè¦æä¾›äº†ç›¸å…³çš„èµ„æºã€‚ManiSkill é»˜è®¤æä¾›äº†ä»£ç å’Œä¸‹è½½é“¾æ¥ï¼Œä»¥ä¾¿ä½¿ç”¨ [RoboCasa](https://github.com/robocasa/robocasa)ã€[ReplicaCAD](https://aihabitat.org/datasets/replica_cad/) å’Œ [AI2THOR](https://github.com/allenai/ai2thor) ç­‰åœºæ™¯æ•°æ®é›†ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ã€‚è¿™äº›åœºæ™¯å› å…¶ä¸€èˆ¬è¾ƒé«˜çš„å»ºæ¨¡è´¨é‡å’Œäº’åŠ¨æ€§è€Œè¢«é€‰ä¸­ã€‚

ManiSkill è¿˜æ”¯æŒå¼‚æ„ GPU ä»¿çœŸï¼Œå…¶ä¸­æ¯ä¸ªå¹¶è¡Œç¯å¢ƒå¯ä»¥å…·æœ‰ä¸åŒçš„ç‰©ä½“å’Œçº¹ç†ã€‚ä»¥ä¸‹æ˜¯ç”±ä»¿çœŸå™¨ç”Ÿæˆçš„é¸Ÿç°å›¾ç¤ºä¾‹ï¼Œå±•ç¤ºäº† RoboCasa å¨æˆ¿åœºæ™¯

è¦å¼€å§‹ä½¿ç”¨è¿™äº›åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½å®ƒä»¬ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœåœ¨å·¥ä½œä¸­ä½¿ç”¨è¿™äº›åœºæ™¯ï¼Œè¯·åŒæ—¶å¼•ç”¨ ManiSkill3 å’Œåœºæ™¯æ•°æ®é›†çš„ä½œè€…ã€‚

```bash
# åˆ—å‡ºæ‰€æœ‰å¯ä¸‹è½½çš„åœºæ™¯æ•°æ®é›†
python -m mani_skill.utils.download_asset --list "scene"
python -m mani_skill.utils.download_asset ReplicaCAD # å°åœºæ™¯ï¼Œä¸‹è½½é€Ÿåº¦å¿«
python -m mani_skill.utils.download_asset RoboCasa # å¤§é‡ç¨‹åºç”Ÿæˆçš„åœºæ™¯ï¼Œä¸‹è½½é€Ÿåº¦å¿«
python -m mani_skill.utils.download_asset AI2THOR # å¤§é‡åœºæ™¯ï¼Œä¸‹è½½é€Ÿåº¦æ…¢
```

## æ¢ç´¢åœºæ™¯æ•°æ®é›†

è¦æ¢ç´¢åœºæ™¯æ•°æ®é›†ï¼Œå¯ä»¥æä¾›ç¯å¢ƒ ID å’Œç§å­ï¼ˆå¦‚æœæœ‰å¤šä¸ªå¯ç”¨åœºæ™¯ï¼Œå¯æ›´æ”¹é‡‡æ ·çš„åœºæ™¯ï¼‰ï¼Œå¹¶è¿è¡ŒéšæœºåŠ¨ä½œè„šæœ¬ã€‚ä¸‹é¢å±•ç¤ºäº†å·²ç»é…ç½®å¥½çš„å„ç§ç¯å¢ƒï¼Œå¯ä»¥ç”¨æ¥ä¸ RoboCasaã€ReplicaCAD å’Œ ArchitecTHORï¼ˆAI2THOR çš„ä¸€ä¸ªå˜ä½“ï¼‰è¿›è¡Œäº¤äº’ã€‚

```bash
python -m mani_skill.examples.demo_random_action \
  -e "ReplicaCAD_SceneManipulation-v1" \
  --render-mode="rgb_array" --record-dir="videos" # æ— å¤´æ¨¡å¼è¿è¡Œå¹¶ä¿å­˜è§†é¢‘

python -m mani_skill.examples.demo_random_action \
  -e "ArchitecTHOR_SceneManipulation-v1" --render-mode="human" \
  -s 3 # æ‰“å¼€ GUI å¹¶ä½¿ç”¨ç§å­ 3 é‡‡æ ·ä¸€ä¸ªåœºæ™¯

# åŠ è½½ 4 ä¸ªç¯å¢ƒå¹¶ä½¿ç”¨ç§å­ 0, 1, 2, 3 é‡‡æ ·åœºæ™¯
# ä½¿ç”¨ fetch æœºå™¨äºº
python -m mani_skill.examples.demo_random_action \
  -e "RoboCasaKitchen-v1" \
  -n 4 -s 0 1 2 3 \
  --render-mode="human" -r "fetch"
```

è¿˜å¯ä»¥ä¼ é€’ `-r "none"` æ¥åœ¨æ²¡æœ‰ä»»ä½•æ™ºèƒ½ä½“çš„æƒ…å†µä¸‹è¿è¡Œç¯å¢ƒã€‚

## åœ¨åœºæ™¯æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒ

åƒ ReplicaCAD å’Œ AI2THOR è¿™æ ·çš„å¤§å‹åœºæ™¯æ•°æ®é›†ï¼ŒåŒ…å«æ•°ç™¾ä¸ªç‰©ä½“ï¼Œå¯ä»¥ç”¨äºè®­ç»ƒæ›´é€šç”¨çš„æœºå™¨äºº/æ™ºèƒ½ä½“ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä½œä¸ºåˆæˆæ•°æ®ç”Ÿæˆçš„æ¥æºã€‚æˆ‘ä»¬ä»åœ¨æä¾›æ›´å¤šç¤ºä¾‹ä»£ç å’Œæ–‡æ¡£çš„è¿‡ç¨‹ä¸­ï¼Œä»¥ä¾¿æ›´å¥½åœ°åˆ©ç”¨è¿™äº›åœºæ™¯æ•°æ®é›†ï¼Œä½†ç›®å‰æˆ‘ä»¬æä¾›äº†ä»£ç æ¥æ¢ç´¢å’Œä¸è¿™äº›åœºæ™¯æ•°æ®é›†è¿›è¡Œäº¤äº’ã€‚

### å¼ºåŒ–å­¦ä¹  / æ¨¡ä»¿å­¦ä¹ 

æˆ‘ä»¬ç›®å‰æ­£åœ¨æ„å»ºç±»ä¼¼äº ReplicaCAD Rearrange æŒ‘æˆ˜çš„ä»»åŠ¡ä»£ç ï¼Œå¹¶å°†åœ¨å®Œæˆåå¼€æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç›®å‰æ²¡æœ‰ä»»ä½•è®­ç»ƒä»»åŠ¡å…·æœ‰å®šä¹‰çš„æˆåŠŸ/å¤±è´¥æ¡ä»¶å’Œ/æˆ–å¥–åŠ±ï¼Œå¹¶ä¸”ä½¿ç”¨ä»»ä½•å¤§å‹åœºæ™¯æ•°æ®é›†ã€‚

# æ¼”ç¤º

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä»»åŠ¡ ID ä»æˆ‘ä»¬çš„ [Hugging Face ğŸ¤— æ•°æ®é›†](https://huggingface.co/datasets/haosulab/ManiSkill_Demonstrations)ç›´æ¥ä¸‹è½½æ¼”ç¤ºã€‚è¯¥å·¥å…·å°†æ¼”ç¤ºæ–‡ä»¶ä¸‹è½½åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”è¿˜ä¼šä¸‹è½½ä¸€äº›å±•ç¤ºæ¼”ç¤ºå¤–è§‚çš„è§†é¢‘ã€‚æœ‰å…³æ‰€æœ‰æ”¯æŒçš„ä»»åŠ¡åŠå…¶æ¼”ç¤ºçš„åˆ—è¡¨ï¼Œè¯·å‚è§ [ä»»åŠ¡](https://7mlcen.aitianhu6.top/tasks/index.md)ã€‚

```bash
# ä¸‹è½½ç‰¹å®šä»»åŠ¡çš„æ¼”ç¤ºæ•°æ®é›†
python -m mani_skill.utils.download_demo ${ENV_ID}
python -m mani_skill.utils.download_demo # æ²¡æœ‰å‚æ•°æ—¶ï¼Œè¿™ä¼šæ‰“å°æ‰€æœ‰å¯ç”¨çš„æ•°æ®é›†
# ä¸‹è½½å®Œæ•´çš„æ•°æ®é›†ï¼ˆå¯èƒ½éå¸¸æ…¢ï¼‰
python -m mani_skill.utils.download_demo all
```

æ¼”ç¤ºæ•°æ®é›†é€šå¸¸ä»¥ç®€åŒ–æ ¼å¼å­˜å‚¨ï¼ˆä¾‹å¦‚ï¼Œä¸åŒ…å«è§‚å¯Ÿæ•°æ®ï¼‰ï¼Œè€Œæ˜¯å­˜å‚¨ç¯å¢ƒçŠ¶æ€ä»¥è¿›è¡Œå‹ç¼©ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªçµæ´»çš„å·¥å…·ï¼Œå¯ä»¥é‡æ’­æ¼”ç¤ºæ•°æ®é›†å¹¶ä¿®æ”¹å®ƒä»¬ï¼Œä¾‹å¦‚æ·»åŠ è§†è§‰è§‚å¯Ÿæ•°æ®ã€å½•åˆ¶è§†é¢‘ç­‰ï¼Œè¯¦è§ [è½¨è¿¹é‡æ’­æ–‡æ¡£](https://7mlcen.aitianhu6.top/datasets/replay.md)ã€‚å¦‚æœå¸Œæœ›åœ¨æœ¬åœ°ç”ŸæˆåŸå§‹çš„å‹ç¼©æ•°æ®é›†ï¼Œæˆ‘ä»¬å°†ç”¨äºæ•°æ®é›†ç”Ÿæˆçš„æ‰€æœ‰è„šæœ¬ä¿å­˜åœ¨ [data_generation](https://github.com/haosulab/ManiSkill/tree/main/scripts/data_generation) æ–‡ä»¶å¤¹ä¸­ã€‚å¯¹äºå¸Œæœ›åŸºå‡†åŒ–æ¨¡ä»¿å­¦ä¹ çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®éµå¾ª [æ¨¡ä»¿å­¦ä¹ è®¾ç½®é¡µé¢](https://7mlcen.aitianhu6.top/learning_from_demos/setup.md) ä¸Šçš„è¯´æ˜ï¼Œäº†è§£å¦‚ä½•é‡æ’­å‹ç¼©æ•°æ®é›†ä»¥è¿›è¡Œè®­ç»ƒæ•°æ®é›†çš„åŸºå‡†æµ‹è¯•ã€‚

## æ ¼å¼

æ¯ä¸ªä»»åŠ¡çš„æ‰€æœ‰æ¼”ç¤ºéƒ½ä»¥ HDF5 æ ¼å¼ä¿å­˜ï¼Œå¯ä»¥é€šè¿‡ [h5py](https://github.com/h5py/h5py) æ‰“å¼€ã€‚æ¯ä¸ª HDF5 æ•°æ®é›†å‘½åä¸º `trajectory.{obs_mode}.{control_mode}.{sim_backend}.h5`ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªä¸å…¶åŒåçš„ JSON å…ƒæ•°æ®æ–‡ä»¶ã€‚é™¤éå¦æœ‰è¯´æ˜ï¼Œ`trajectory.h5` æ˜¯ `trajectory.none.pd_joint_pos.physx_cpu.h5` çš„ç®€å†™ï¼Œå…¶ä¸­åŒ…å«ç”± `pd_joint_pos` æ§åˆ¶å™¨ç”Ÿæˆçš„åŸå§‹æ¼”ç¤ºï¼Œä½¿ç”¨ `none` è§‚å¯Ÿæ¨¡å¼ï¼ˆç©ºè§‚å¯Ÿæ•°æ®ï¼‰å¹¶åœ¨åŸºäº CPU çš„ä»¿çœŸä¸­ç”Ÿæˆã€‚ç„¶è€Œï¼Œå¯èƒ½å­˜åœ¨ç”±å…¶ä»–æ§åˆ¶å™¨ç”Ÿæˆçš„æ¼”ç¤ºã€‚**å› æ­¤ï¼Œè¯·æ£€æŸ¥å…³è”çš„ JSON æ–‡ä»¶ä»¥ç¡®ä¿ä½¿ç”¨äº†å“ªä¸ªæ§åˆ¶å™¨ã€‚**

## å…ƒä¿¡æ¯ (JSON)

æ¯ä¸ª JSON æ–‡ä»¶åŒ…å«ï¼š

- `env_info`ï¼ˆå­—å…¸ï¼‰ï¼šä»»åŠ¡ï¼ˆä¹Ÿç§°ä¸ºç¯å¢ƒï¼‰ä¿¡æ¯ï¼Œå¯ç”¨äºåˆå§‹åŒ–ä»»åŠ¡
  - `env_id`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šä»»åŠ¡ ID
  - `max_episode_steps`ï¼ˆæ•´æ•°ï¼‰
  - `env_kwargs`ï¼ˆå­—å…¸ï¼‰ï¼šåˆå§‹åŒ–ä»»åŠ¡çš„å…³é”®å­—å‚æ•°ã€‚**è¿™æ˜¯é‡ç°ç¯å¢ƒæ‰€å¿…éœ€çš„ã€‚**
- `episodes`ï¼ˆåˆ—è¡¨[å­—å…¸]ï¼‰ï¼šå›åˆä¿¡æ¯
- `source_type`ï¼ˆå¯é€‰[å­—ç¬¦ä¸²]ï¼‰ï¼šä¸€ä¸ªç®€å•çš„åˆ†ç±»å­—ç¬¦ä¸²ï¼Œæè¿°ç”Ÿæˆè½¨è¿¹æ•°æ®çš„è¿‡ç¨‹ã€‚
- `source_desc`ï¼ˆå¯é€‰[å­—ç¬¦ä¸²]ï¼‰ï¼šå¯¹æ•°æ®ç”Ÿæˆè¿‡ç¨‹çš„æ›´é•¿è§£é‡Šã€‚

å›åˆä¿¡æ¯ï¼ˆ`episodes` çš„å…ƒç´ ï¼‰åŒ…æ‹¬ï¼š

- `episode_id`ï¼ˆæ•´æ•°ï¼‰ï¼šå›åˆçš„å”¯ä¸€ ID
- `reset_kwargs`ï¼ˆå­—å…¸ï¼‰ï¼šé‡ç½®ä»»åŠ¡çš„å…³é”®å­—å‚æ•°ã€‚**é‡ç°è½¨è¿¹æ—¶å¿…é¡»ä½¿ç”¨è¿™äº›å‚æ•°ã€‚**
- `control_mode`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºè¯¥å›åˆçš„æ§åˆ¶æ¨¡å¼ã€‚
- `elapsed_steps`ï¼ˆæ•´æ•°ï¼‰ï¼šè½¨è¿¹é•¿åº¦
- `info`ï¼ˆå­—å…¸ï¼‰ï¼šå›åˆç»“æŸæ—¶çš„ä¿¡æ¯ã€‚

ä»…å‡­å…ƒæ•°æ®ï¼Œé€šå¸¸å¯ä»¥é‡ç°ä»»åŠ¡ï¼Œå°±åƒå®ƒåœ¨æ”¶é›†è½¨è¿¹æ—¶åˆ›å»ºçš„æ–¹å¼ä¸€æ ·ï¼š

```python
env = gym.make(env_info["env_id"], **env_info["env_kwargs"])
episode = env_info["episodes"][0] # é€‰æ‹©ç¬¬ä¸€ä¸ª
env.reset(**episode["reset_kwargs"])
```

æœ‰æ—¶è½¨è¿¹æ•°æ®æ˜¯åœ¨ GPU ä»¿çœŸä¸­æ”¶é›†çš„ï¼Œè¿™æ„å‘³ç€éšæœºåŒ–ä¸ä»…ä¾èµ–äºç§å­ï¼Œè¿˜ä¾èµ–äºå¹¶è¡Œç¯å¢ƒçš„æ•°é‡ã€‚ä¸ºäº†ç¡®ä¿ç›¸åŒçš„èµ·å§‹çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨è½¨è¿¹ä¸­çš„ç¬¬ä¸€ä¸ªç¯å¢ƒçŠ¶æ€æ•°æ®ï¼Œå¹¶ç›¸åº”åœ°è®¾ç½®ç¯å¢ƒçŠ¶æ€ã€‚

## è½¨è¿¹æ•°æ® (HDF5)

æ¯ä¸ª HDF5 æ¼”ç¤ºæ•°æ®é›†ç”±å¤šä¸ªè½¨è¿¹ç»„æˆã€‚æ¯ä¸ªè½¨è¿¹çš„é”®æ˜¯ `traj_{episode_id}`ï¼Œä¾‹å¦‚ï¼Œ`traj_0`ã€‚

æ¯ä¸ªè½¨è¿¹æ˜¯ä¸€ä¸ª `h5py.Group`ï¼Œå…¶ä¸­åŒ…å«ï¼š

- actions: [T, A]ï¼Œ`np.float32`ã€‚`T` æ˜¯è½¬ç§»æ¬¡æ•°ã€‚
- terminated: [T]ï¼Œ`np.bool_`ã€‚è¡¨ç¤ºä»»åŠ¡æ˜¯å¦åœ¨æ¯ä¸ªæ—¶é—´æ­¥ç»“æŸã€‚
- truncated: [T]ï¼Œ`np.bool_`ã€‚è¡¨ç¤ºä»»åŠ¡æ˜¯å¦åœ¨æ¯ä¸ªæ—¶é—´æ­¥è¢«æˆªæ–­ã€‚
- env_states: [T+1, D]ï¼Œ`np.float32`ã€‚ç¯å¢ƒçŠ¶æ€ã€‚å¯ä»¥ç”¨æ¥é€šè¿‡ `env.set_state_dict` å°†ç¯å¢ƒè®¾ç½®ä¸ºç‰¹å®šçŠ¶æ€ã€‚ç„¶è€Œï¼Œè¿™å¯èƒ½ä¸è¶³ä»¥é‡ç°è½¨è¿¹ã€‚
- successï¼ˆå¯é€‰ï¼‰ï¼š[T]ï¼Œ`np.bool_`ã€‚è¡¨ç¤ºä»»åŠ¡åœ¨æ¯ä¸ªæ—¶é—´æ­¥æ˜¯å¦æˆåŠŸã€‚å¦‚æœä»»åŠ¡å®šä¹‰äº†æˆåŠŸï¼Œåˆ™åŒ…æ‹¬è¯¥å­—æ®µã€‚
- failï¼ˆå¯é€‰ï¼‰ï¼š[T]ï¼Œ`np.bool_`ã€‚è¡¨ç¤ºä»»åŠ¡åœ¨æ¯ä¸ªæ—¶é—´æ­¥æ˜¯å¦å¤±è´¥ã€‚å¦‚æœä»»åŠ¡å®šä¹‰äº†å¤±è´¥ï¼Œåˆ™åŒ…æ‹¬è¯¥å­—æ®µã€‚
- obsï¼ˆå¯é€‰ï¼‰ï¼š[T+1, D] è§‚å¯Ÿæ•°æ®ã€‚

æ³¨æ„ï¼Œ`env_states` æ˜¯ä»¥å­—å…¸å½¢å¼å­˜å‚¨çš„ï¼ˆè§‚å¯Ÿæ•°æ®ä¹Ÿå¯èƒ½å¦‚æ­¤ï¼Œå…·ä½“å–å†³äºè§‚å¯Ÿæ¨¡å¼ï¼‰ï¼Œå®ƒè¢«æ ¼å¼åŒ–ä¸ºä¸€ä¸ªåˆ—è¡¨å­—å…¸ã€‚ä¾‹å¦‚ï¼Œå…¸å‹çš„ç¯å¢ƒçŠ¶æ€å¦‚ä¸‹æ‰€ç¤ºï¼š

```python
env_state = env.get_state_dict()
"""
env_state = {
  "actors": {
    "actor_id": [...numpy_actor_state...],
    ...
  },
  "articulations": {
    "articulation_id": [...numpy_articulation_state...],
    ...
  }
}
"""
```

åœ¨è½¨è¿¹æ–‡ä»¶ä¸­ï¼Œ`env_states` å°†å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼Œä½†å­—å…¸ä¸­çš„æ¯ä¸ªå€¼/å¶å­èŠ‚ç‚¹å°†æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¯¥å®ä½“åœ¨ä»¿çœŸä¸­éšæ—¶é—´å˜åŒ–çš„çŠ¶æ€åºåˆ—ã€‚

åœ¨å®è·µä¸­ï¼Œä½¿ç”¨ `env_states` æ•°æ®çš„åˆ‡ç‰‡ï¼ˆæˆ–è§‚å¯Ÿæ•°æ®ï¼‰å¯èƒ½ä¼šæ›´æœ‰ç”¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®Œæˆï¼š

```python
import mani_skill.trajectory.utils as trajectory_utils
env_states = trajectory_utils.dict_to_list_of_dicts(env_states)
# ç°åœ¨ env_states[i] å°±æ˜¯ env.get_state_dict() åœ¨ç¬¬ i ä¸ªæ—¶é—´æ­¥è¿”å›çš„æ•°æ®
i = 10
env_state_i = trajectory_utils.index_dict(env_states, i)
# ç°åœ¨ env_state_i å°±æ˜¯ env.get_state_dict() åœ¨ç¬¬ i ä¸ªæ—¶é—´æ­¥è¿”å›çš„æ•°æ®
```

è¿™äº›å·¥å…·ä¹Ÿç”¨äºæˆ‘ä»¬æä¾›çš„ PyTorch æ•°æ®é›†å®ç°ï¼Œè¯¦ç»†ä¿¡æ¯è§ä¸‹ä¸€éƒ¨åˆ†ã€‚

## åŠ è½½è½¨è¿¹æ•°æ®é›†

### PyTorch

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç¤ºä¾‹æ–¹å¼æ¥æ„å»º PyTorch æ•°æ®é›†ï¼Œå¹¶è½»æ¾åŠ è½½è½¨è¿¹ .h5 æ•°æ®ï¼Œå…·ä½“è¯·è§ https://github.com/haosulab/ManiSkill/tree/main/mani_skill/trajectory/datasets.pyã€‚è™½ç„¶å®ƒä¸æ˜¯è¶…çº§ä¼˜åŒ–çš„ï¼Œä½†å±•ç¤ºäº†å¦‚ä½•çµæ´»åœ°å¤„ç†æˆ‘ä»¬çš„æ•°æ®æ ¼å¼ã€‚ä»£ç å‰¯æœ¬å·²ç²˜è´´åœ¨ä¸‹é¢çš„ä¸‹æ‹‰æ¡†ä¸­ã€‚

:::{dropdown} dataset.py
:color: primary
:icon: code

```python
from typing import Union
import h5py
import numpy as np
from torch.utils.data import Dataset
from tqdm import tqdm

from mani_skill.utils.io_utils import load_json
from mani_skill.utils import sapien_utils
from mani_skill.utils import common

# loads h5 data into memory for faster access
def load_h5_data(data):
    out = dict()
    for k in data.keys():
        if isinstance(data[k], h5py.Dataset):
            out[k] = data[k][:]
        else:
            out[k] = load_h5_data(data[k])
    return out

class ManiSkillTrajectoryDataset(Dataset):
    """
    ä¸€ä¸ªé€šç”¨çš„ PyTorch æ•°æ®é›†ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨å®ƒåŠ è½½ä»»ä½•ç”± ManiSkill ç”Ÿæˆçš„è½¨è¿¹ .h5 æ•°æ®ã€‚
    è¿™ä¸ªç±»åªæ˜¯ä¸€ä¸ªç®€å•çš„èµ·å§‹ä»£ç ï¼Œç”¨äºè½»æ¾åŠ è½½è½¨è¿¹æ•°æ®ï¼Œä½†ä¸åšä»»ä½•æ•°æ®è½¬æ¢æˆ–é«˜çº§æ“ä½œ
    æˆ‘ä»¬å»ºè®®ç›´æ¥å¤åˆ¶æ­¤ä»£ç å¹¶æ ¹æ®æ›´é«˜çº§çš„ç”¨ä¾‹è¿›è¡Œä¿®æ”¹

    å‚æ•°ï¼š
        dataset_file (str): è¦åŠ è½½çš„æ•°æ® .h5 æ–‡ä»¶çš„è·¯å¾„
        load_count (int): è¦åŠ è½½åˆ°å†…å­˜ä¸­çš„è½¨è¿¹æ•°é‡ã€‚å¦‚æœä¸º -1ï¼Œå°†åŠ è½½æ‰€æœ‰æ•°æ®
        success_only (bool): æ˜¯å¦è·³è¿‡æœ€ç»ˆä¸æˆåŠŸçš„è½¨è¿¹ã€‚é»˜è®¤ä¸º False
        device: æ•°æ®ä¿å­˜çš„ä½ç½®ã€‚å¦‚æœä¸º Noneï¼Œå°†ä»¥ numpy æ ¼å¼å­˜å‚¨ï¼ˆé»˜è®¤ï¼‰ï¼Œå¦åˆ™ä¼šå°†æ•°æ®ç§»åŠ¨åˆ°æŒ‡å®šçš„è®¾å¤‡ä¸Š
    """

    def __init__(self, dataset_file: str, load_count=-1, success_only: bool = False, device = None) -> None:
        self.dataset_file = dataset_file
        self.device = device
        self.data = h5py.File(dataset_file, "r")
        json_path = dataset_file.replace(".h5", ".json")
        self.json_data = load_json(json_path)
        self.episodes = self.json_data["episodes"]
        self.env_info = self.json_data["env_info"]
        self.env_id = self.env_info["env_id"]
        self.env_kwargs = self.env_info["env_kwargs"]

        self.obs = None
        self.actions = []
        self.terminated = []
        self.truncated = []
        self.success, self.fail, self.rewards = None, None, None
        if load_count == -1:
            load_count = len(self.episodes)
        for eps_id in tqdm(range(load_count)):
            eps = self.episodes[eps_id]
            if success_only: 
                assert "success" in eps, "episodes in this dataset do not have the success attribute, cannot load dataset with success_only=True"
                if not eps["success"]:
                    continue
            trajectory = self.data[f"traj_{eps['episode_id']}"]
            trajectory = load_h5_data(trajectory)
            eps_len = len(trajectory["actions"])

            # exclude the final observation as most learning workflows do not use it
            obs = common.index_dict_array(trajectory["obs"], slice(eps_len))
            if eps_id == 0:
                self.obs = obs
            else:
                self.obs = common.append_dict_array(self.obs, obs)

            self.actions.append(trajectory["actions"])
            self.terminated.append(trajectory["terminated"])
            self.truncated.append(trajectory["truncated"])

            # handle data that might optionally be in the trajectory
            if "rewards" in trajectory:
                if self.rewards is None:
                    self.rewards = [trajectory["rewards"]]
                else:
                    self.rewards.append(trajectory["rewards"])
            if "success" in trajectory:
                if self.success is None:
                    self.success = [trajectory["success"]]
                else:
                    self.success.append(trajectory["success"])
            if "fail" in trajectory:
                if self.fail is None:
                    self.fail = [trajectory["fail"]]
                else:
                    self.fail.append(trajectory["fail"])

        self.actions = np.vstack(self.actions)
        self.terminated = np.concatenate(self.terminated)
        self.truncated = np.concatenate(self.truncated)

        if self.rewards is not None:
            self.rewards = np.concatenate(self.rewards)
        if self.success is not None:
            self.success = np.concatenate(self.success)
        if self.fail is not None:
            self.fail = np.concatenate(self.fail)

        def remove_np_uint16(x: Union[np.ndarray, dict]):
            if isinstance(x, dict):
                for k in x.keys():
                    x[k] = remove_np_uint16(x[k])
                return x
            else:
                if x.dtype == np.uint16:
                    return x.astype(np.int32)
                return x

        # uint16 dtype is used to conserve disk space and memory
        # you can optimize this dataset code to keep it as uint16 and process that
        # dtype of data yourself. for simplicity we simply cast to a int32 so
        # it can automatically be converted to torch tensors without complaint
        self.obs = remove_np_uint16(self.obs)

        if device is not None:
            self.actions = sapien_utils.to_tensor(self.actions, device=device)
            self.obs = sapien_utils.to_tensor(self.obs, device=device)
            self.terminated = sapien_utils.to_tensor(self.terminated, device=device)
            self.truncated = sapien_utils.to_tensor(self.truncated, device=device)
            if self.rewards is not None:
                self.rewards = sapien_utils.to_tensor(self.rewards, device=device)
            if self.success is not None:
                self.success = sapien_utils.to_tensor(self.terminated, device=device)
            if self.fail is not None:
                self.fail = sapien_utils.to_tensor(self.truncated, device=device)
    def __len__(self):
        return len(self.actions)


    def __getitem__(self, idx):
        action = sapien_utils.to_tensor(self.actions[idx], device=self.device)
        obs = common.index_dict_array(self.obs, idx, inplace=False)

        res = dict(
            obs=obs,
            action=action,
            terminated=self.terminated[idx],
            truncated=self.truncated[idx],
        )
        if self.rewards is not None:
            res.update(reward=self.rewards[idx])
        if self.success is not None:
            res.update(success=self.success[idx])
        if self.fail is not None:
            res.update(fail=self.fail[idx])
        return res
```

:::

# è½¨è¿¹é‡æ’­/è½¬æ¢

ManiSkill æä¾›äº†å·¥å…·ï¼Œä¸ä»…å¯ä»¥æ”¶é›†/åŠ è½½è½¨è¿¹ï¼Œè¿˜å¯ä»¥é‡æ’­è½¨è¿¹å¹¶è½¬æ¢è§‚å¯Ÿ/åŠ¨ä½œã€‚

è¦é‡æ’­æ¼”ç¤ºï¼ˆä¸æ”¹å˜è§‚å¯Ÿæ¨¡å¼å’Œæ§åˆ¶æ¨¡å¼ï¼‰ï¼š

```bash
# é€šè¿‡ sapien viewer é‡æ’­å¹¶æŸ¥çœ‹è½¨è¿¹
python -m mani_skill.trajectory.replay_trajectory \
    --traj-path ~/.maniskill/demos/PushCube-v1/motionplanning/trajectory.h5 \
    --vis

# ä¿å­˜è½¨è¿¹çš„è§†é¢‘ï¼ˆä¿å­˜åˆ°ä¸è½¨è¿¹ç›¸åŒçš„ç›®å½•ï¼‰
python -m mani_skill.trajectory.replay_trajectory \
    --traj-path ~/.maniskill/demos/PushCube-v1/motionplanning/trajectory.h5 \
    --save-video

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨é€‰é¡¹
python -m mani_skill.trajectory.replay_trajectory -h
```

ç»“æœåˆ†åˆ«å¦‚ä¸‹

![](assets/2025-03-21-22-26-17-image.png)

![](assets/2025-03-21-22-28-41-image.png)

:::{note}
è¯¥è„šæœ¬è¦æ±‚ `trajectory.h5` å’Œ `trajectory.json` æ–‡ä»¶éƒ½ä½äºç›¸åŒç›®å½•ä¸‹ã€‚
:::

é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸå§‹æ¼”ç¤ºæ–‡ä»¶åŒ…å«é‡ç°è½¨è¿¹æ‰€éœ€çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ˆä¾‹å¦‚åˆå§‹çŠ¶æ€ã€åŠ¨ä½œã€ç§å­ï¼‰ã€‚ç”±äºæ²¡æœ‰åå¤„ç†ï¼Œè§‚å¯Ÿæ•°æ®é€šå¸¸ä¸åŒ…å«åœ¨å†…ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å¯¼è‡´æ–‡ä»¶å¤§å°è¿‡å¤§ã€‚æ­¤å¤–ï¼Œè¿™äº›æ–‡ä»¶ä¸­çš„åŠ¨ä½œä¸æ¶µç›–æ‰€æœ‰æ§åˆ¶æ¨¡å¼ã€‚å› æ­¤ï¼Œéœ€è¦å°†åŸå§‹æ–‡ä»¶è½¬æ¢ä¸ºæ‰€éœ€çš„è§‚å¯Ÿå’Œæ§åˆ¶æ¨¡å¼ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®ç”¨è„šæœ¬ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```bash
# é‡æ’­æ¼”ç¤ºï¼Œæ§åˆ¶æ¨¡å¼ä¸º pd_joint_delta_pos
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/motionplanning/trajectory.h5 \
  --save-traj --target-control-mode pd_joint_delta_pos \
  --obs-mode none #--num-procs 10
```

![](assets/2025-03-21-23-10-46-image.png)

:::{dropdown} ç‚¹å‡»æŸ¥çœ‹è½¨è¿¹é‡æ’­å·¥å…·é€‰é¡¹

```
â•­â”€ options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ -h, --help              æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º                                                                                                      â”‚
â”‚ --traj-path STR         è¦é‡æ’­çš„è½¨è¿¹ .h5 æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰                                                                                         â”‚
â”‚ --sim-backend {None}|STR, -b {None}|STR                                                                                                          â”‚
â”‚                         ä½¿ç”¨çš„ä»¿çœŸåç«¯ï¼Œå¯ä»¥æ˜¯ 'physx_cpu' æˆ– 'physx_gpu'ã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨æ”¶é›†è½¨è¿¹æ•°æ®æ—¶çš„åç«¯ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰               â”‚
â”‚ --obs-mode {None}|STR, -o {None}|STR                                                                                                             â”‚
â”‚                         è¦è®°å½•åˆ°è½¨è¿¹ä¸­çš„ç›®æ ‡è§‚å¯Ÿæ¨¡å¼ã€‚è¯·å‚è§                                                                                     â”‚
â”‚                         https://maniskill.readthedocs.io/en/latest/user_guide/concepts/observation.html è·å–å®Œæ•´çš„æ”¯æŒçš„è§‚å¯Ÿæ¨¡å¼åˆ—è¡¨ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰ â”‚
â”‚ --target-control-mode {None}|STR, -c {None}|STR                                                                                                â”‚
â”‚                         è¦è½¬æ¢ä¸ºçš„ç›®æ ‡æ§åˆ¶æ¨¡å¼ã€‚                                                                                               â”‚
â”‚                         æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰æ§åˆ¶æ¨¡å¼å¯ä»¥æˆåŠŸè½¬æ¢ï¼Œä¸”å¹¶éæ‰€æœ‰æœºå™¨äººéƒ½æœ‰å®¹æ˜“è½¬æ¢çš„æ§åˆ¶æ¨¡å¼ã€‚                                           â”‚
â”‚                         ç›®å‰ Panda æœºå™¨äººåœ¨æ§åˆ¶æ¨¡å¼è½¬æ¢æ–¹é¢æ”¯æŒå¾—æœ€å¥½ã€‚æ­¤å¤–ï¼Œåœ¨ GPU å¹¶è¡ŒåŒ–ç¯å¢ƒä¸­ä¸æ”¯æŒæ§åˆ¶æ¨¡å¼è½¬æ¢ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰            â”‚
â”‚ --verbose, --no-verbose                                                                                                                        â”‚
â”‚                         æ˜¯å¦åœ¨è½¨è¿¹é‡æ’­è¿‡ç¨‹ä¸­æ‰“å°è¯¦ç»†ä¿¡æ¯ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                       â”‚
â”‚ --save-traj, --no-save-traj                                                                                                                    â”‚
â”‚                         æ˜¯å¦ä¿å­˜è½¨è¿¹åˆ°ç£ç›˜ã€‚è¿™ä¸ä¼šè¦†ç›–åŸå§‹è½¨è¿¹æ–‡ä»¶ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                           â”‚
â”‚ --save-video, --no-save-video                                                                                                                  â”‚
â”‚                         æ˜¯å¦ä¿å­˜è§†é¢‘ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                                             â”‚
â”‚ --num-procs INT         ç”¨äºå¹¶è¡ŒåŒ–è½¨è¿¹é‡æ’­è¿‡ç¨‹çš„è¿›ç¨‹æ•°ã€‚å¯¹äº CPU åç«¯ï¼Œé€šå¸¸é€šè¿‡ Python å¤šè¿›ç¨‹å¹¶è¡ŒåŒ–ã€‚                                               â”‚
â”‚                         å¯¹äºåƒ physx_gpu è¿™æ ·çš„å¹¶è¡Œä»¿çœŸåç«¯ï¼Œè¿™å°†åœ¨å•ä¸ª Python è¿›ç¨‹å†…é€šè¿‡åˆ©ç”¨ GPU æ¥å¹¶è¡ŒåŒ–ã€‚ï¼ˆé»˜è®¤ï¼š1ï¼‰                             â”‚
â”‚ --max-retry INT         åœ¨ä»»åŠ¡æˆåŠŸç»“æŸå‰ï¼Œé‡æ’­è½¨è¿¹çš„æœ€å¤§å°è¯•æ¬¡æ•°ã€‚ï¼ˆé»˜è®¤ï¼š0ï¼‰                                                                  â”‚
â”‚ --discard-timeout, --no-discard-timeout                                                                                                        â”‚
â”‚                         æ˜¯å¦ä¸¢å¼ƒè¶…æ—¶å¹¶è¢«æˆªæ–­çš„å›åˆï¼ˆå–å†³äºä»»åŠ¡çš„ max_episode_steps å‚æ•°ï¼‰                                                     â”‚
â”‚                         ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                                                       â”‚
â”‚ --allow-failure, --no-allow-failure                                                                                                            â”‚
â”‚                         æ˜¯å¦åŒ…å«å¤±è´¥çš„å›åˆï¼Œåœ¨ä¿å­˜çš„è§†é¢‘å’Œè½¨è¿¹æ•°æ®ä¸­æ ¹æ®ç¯å¢ƒçš„è¯„ä¼°è¿”å›çš„ "success" æ ‡ç­¾å†³å®š                                          â”‚
â”‚                         ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                                                       â”‚
â”‚ --vis, --no-vis         æ˜¯å¦é€šè¿‡ GUI å¯è§†åŒ–è½¨è¿¹é‡æ’­ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                            â”‚
â”‚ --use-env-states, --no-use-env-states                                                                                                          â”‚
â”‚                         æ˜¯å¦é€šè¿‡ç¯å¢ƒçŠ¶æ€é‡æ’­ï¼Œè€Œä¸æ˜¯é€šè¿‡åŠ¨ä½œã€‚è¿™å¯ä»¥ä¿è¯ç¯å¢ƒåœ¨æ¯ä¸ªæ­¥éª¤çœ‹èµ·æ¥ä¸åŸå§‹è½¨è¿¹å®Œå…¨ç›¸åŒã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                      â”‚
â”‚ --use-first-env-state, --no-use-first-env-state                                                                                                â”‚
â”‚                         æ˜¯å¦ä½¿ç”¨è½¨è¿¹ä¸­çš„ç¬¬ä¸€ä¸ªç¯å¢ƒçŠ¶æ€æ¥è®¾ç½®åˆå§‹çŠ¶æ€ã€‚è¿™å¯¹äºå°è¯•å°†æ”¶é›†è‡ª CPU ä»¿çœŸä¸­çš„æ¼”ç¤ºé‡æ’­åˆ° GPU ä»¿çœŸä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸º GPU         â”‚
â”‚                         ä»¿çœŸå³ä½¿ç»™å®šç›¸åŒç§å­ä¹Ÿä¼šä»¥ä¸åŒçš„æ–¹å¼éšæœºåŒ–åˆå§‹çŠ¶æ€ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                      â”‚
â”‚ --count {None}|INT      è¦é‡æ’­çš„æ¼”ç¤ºæ•°é‡ï¼Œç›´åˆ°é€€å‡ºã€‚é»˜è®¤æƒ…å†µä¸‹å°†é‡æ’­æ‰€æœ‰æ¼”ç¤ºï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                    â”‚
â”‚ --reward-mode {None}|STR                                                                                                                       â”‚
â”‚                         æŒ‡å®šç¯å¢ƒåº”ä½¿ç”¨çš„å¥–åŠ±ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹å°†é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¯æŒçš„å¥–åŠ±æ¨¡å¼ã€‚å¤§å¤šæ•°ç¯å¢ƒæ”¯æŒ 'sparse'ã€'none'ï¼Œæœ‰äº›è¿˜æ”¯æŒ 'normalized_dense' â”‚
â”‚                         å’Œ 'dense' å¥–åŠ±æ¨¡å¼ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                                                       â”‚
â”‚ --record-rewards, --no-record-rewards                                                                                                          â”‚
â”‚                         æ˜¯å¦åœ¨é‡æ’­çš„è½¨è¿¹ä¸­åŒ…å«å¥–åŠ±ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                              â”‚
â”‚ --shader {None}|STR     æ›´æ”¹æ‰€æœ‰ç›¸æœºæ¸²æŸ“ä½¿ç”¨çš„ç€è‰²å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨åŸå§‹æ•°æ®æ”¶é›†æ—¶ä½¿ç”¨çš„ç€è‰²å™¨ã€‚å¯ä»¥é€‰æ‹© 'rt' è¿›è¡Œå…‰çº¿è¿½è¸ªç”Ÿæˆé€¼çœŸçš„æ¸²æŸ“ï¼Œ            â”‚
â”‚                         ä¹Ÿå¯ä»¥é€‰æ‹© 'rt-fast' è¿›è¡Œæ›´å¿«ä½†è´¨é‡è¾ƒä½çš„å…‰çº¿è¿½è¸ªæ¸²æŸ“ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                 â”‚
â”‚ --video-fps {None}|INT  ä¿å­˜è§†é¢‘çš„ FPSã€‚é»˜è®¤ä¸ºæ§åˆ¶é¢‘ç‡ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                                           â”‚
â”‚ --render-mode STR       ç”¨äºä¿å­˜è§†é¢‘çš„æ¸²æŸ“æ¨¡å¼ã€‚é€šå¸¸è¿˜åŒ…æ‹¬ 'sensors' å’Œ 'all' æ¸²æŸ“æ¨¡å¼ï¼Œè¿›ä¸€æ­¥æ¸²æŸ“æ‰€æœ‰ä¼ æ„Ÿå™¨è¾“å‡ºï¼Œå¦‚ç›¸æœºã€‚ï¼ˆé»˜è®¤ï¼šrgb_arrayï¼‰         â”‚
â”‚ --num-envs INT, -n INT  è¦è¿è¡Œçš„ç¯å¢ƒæ•°é‡ä»¥é‡æ’­è½¨è¿¹ã€‚å¯¹äº CPU åç«¯ï¼Œé€šå¸¸é€šè¿‡ Python å¤šè¿›ç¨‹å¹¶è¡ŒåŒ–ã€‚                                                 â”‚
â”‚                         å¯¹äºåƒ physx_gpu è¿™æ ·çš„å¹¶è¡Œä»¿çœŸåç«¯ï¼Œè¿™å°†åœ¨å•ä¸ª Python è¿›ç¨‹å†…é€šè¿‡åˆ©ç”¨ GPU æ¥å¹¶è¡ŒåŒ–ã€‚ï¼ˆé»˜è®¤ï¼š1ï¼‰                             â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

ä½†æ˜¯æœ€æ–°çš„å‚æ•°å‡ºç°äº†å˜åŒ–

â•­â”€ é€‰é¡¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ -h, --help                                                                 â”‚
â”‚     æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º                                                     â”‚
â”‚ --traj-path STR                                                            â”‚
â”‚     éœ€è¦å›æ”¾çš„è½¨è¿¹ .h5 æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰                                     â”‚
â”‚ -b {None}|STR, --sim-backend {None}|STR                                    â”‚
â”‚     ä½¿ç”¨çš„ä»¿çœŸåç«¯ã€‚å¯ä»¥æ˜¯ 'physx_cpu' æˆ– 'physx_gpu'ã€‚å¦‚æœæœªæŒ‡å®šï¼Œ      â”‚
â”‚     é»˜è®¤ä½¿ç”¨æ”¶é›†è½¨è¿¹æ•°æ®æ—¶ä½¿ç”¨çš„åç«¯ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                         â”‚
â”‚ -o {None}|STR, --obs-mode {None}|STR                                       â”‚
â”‚     ç›®æ ‡è§‚å¯Ÿæ¨¡å¼ï¼Œç”¨äºè®°å½•è½¨è¿¹ä¸­çš„è§‚å¯Ÿæ•°æ®ã€‚æŸ¥çœ‹                          â”‚
â”‚     https://maniskill.readthedocs.io/en/latest/user_guide/concepts/observâ€¦ â”‚
â”‚     è·å–æ”¯æŒçš„æ‰€æœ‰è§‚å¯Ÿæ¨¡å¼çš„å®Œæ•´åˆ—è¡¨ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                      â”‚
â”‚ -c {None}|STR, --target-control-mode {None}|STR                            â”‚
â”‚     ç›®æ ‡æ§åˆ¶æ¨¡å¼ï¼Œç”¨äºå°†ç¤ºèŒƒåŠ¨ä½œè½¬æ¢ä¸ºå…¶ä»–æ§åˆ¶æ¨¡å¼ã€‚æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰çš„æ§åˆ¶ â”‚
â”‚     æ¨¡å¼éƒ½èƒ½æˆåŠŸè½¬æ¢ï¼Œå¹¶ä¸”å¹¶éæ‰€æœ‰æœºå™¨äººéƒ½æ”¯æŒè½»æ¾è½¬æ¢æ§åˆ¶æ¨¡å¼ã€‚          â”‚
â”‚     ç›®å‰ï¼ŒPanda æœºå™¨äººåœ¨æ§åˆ¶æ¨¡å¼è½¬æ¢æ–¹é¢æ”¯æŒæœ€å¥½ã€‚å¹¶ä¸”ï¼Œåœ¨ GPU å¹¶è¡ŒåŒ–ç¯å¢ƒ â”‚
â”‚     ä¸‹ä¸æ”¯æŒæ§åˆ¶æ¨¡å¼è½¬æ¢ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                  â”‚
â”‚ --verbose, --no-verbose                                                    â”‚
â”‚     æ˜¯å¦åœ¨å›æ”¾è½¨è¿¹æ—¶æ‰“å°è¯¦ç»†ä¿¡æ¯ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                          â”‚
â”‚ --save-traj, --no-save-traj                                                â”‚
â”‚     æ˜¯å¦å°†è½¨è¿¹ä¿å­˜åˆ°ç£ç›˜ã€‚æ­¤æ“ä½œä¸ä¼šè¦†ç›–åŸå§‹è½¨è¿¹æ–‡ä»¶ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰        â”‚
â”‚ --save-video, --no-save-video                                              â”‚
â”‚     æ˜¯å¦ä¿å­˜è§†é¢‘ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                          â”‚
â”‚ --max-retry INT                                                            â”‚
â”‚     å›æ”¾è½¨è¿¹æ—¶æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç›´åˆ°ä»»åŠ¡åœ¨ç»“æŸæ—¶è¾¾åˆ°æˆåŠŸçŠ¶æ€ã€‚ï¼ˆé»˜è®¤ï¼š0ï¼‰      â”‚
â”‚ --discard-timeout, --no-discard-timeout                                    â”‚
â”‚     æ˜¯å¦ä¸¢å¼ƒè¶…æ—¶å¹¶è¢«æˆªæ–­çš„å›åˆï¼ˆå–å†³äºä»»åŠ¡çš„ max_episode_steps å‚æ•°ï¼‰      â”‚
â”‚     ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                        â”‚
â”‚ --allow-failure, --no-allow-failure                                        â”‚
â”‚     æ˜¯å¦åœ¨ä¿å­˜çš„è§†é¢‘å’Œè½¨è¿¹æ•°æ®ä¸­åŒ…å«å¤±è´¥çš„å›åˆï¼ŒåŸºäºç¯å¢ƒçš„è¯„ä¼°è¿”å›çš„â€œæˆåŠŸâ€ â”‚
â”‚     æ ‡ç­¾ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                  â”‚
â”‚ --vis, --no-vis                                                            â”‚
â”‚     æ˜¯å¦é€šè¿‡ GUI å¯è§†åŒ–å›æ”¾è½¨è¿¹ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                            â”‚
â”‚ --use-env-states, --no-use-env-states                                      â”‚
â”‚     æ˜¯å¦ä½¿ç”¨ç¯å¢ƒçŠ¶æ€è€Œä¸æ˜¯åŠ¨ä½œè¿›è¡Œå›æ”¾ã€‚è¿™æ ·å¯ä»¥ä¿è¯ç¯å¢ƒçš„æ¯ä¸€æ­¥çŠ¶æ€ä¸      â”‚
â”‚     åŸå§‹è½¨è¿¹å®Œå…¨ç›¸åŒã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                        â”‚
â”‚ --use-first-env-state, --no-use-first-env-state                            â”‚
â”‚     ä½¿ç”¨è½¨è¿¹ä¸­çš„ç¬¬ä¸€ä¸ªç¯å¢ƒçŠ¶æ€æ¥è®¾ç½®åˆå§‹çŠ¶æ€ã€‚å¯¹äºå°è¯•åœ¨ GPU ä»¿çœŸä¸­å›æ”¾    â”‚
â”‚     åœ¨ CPU ä»¿çœŸä¸­æ”¶é›†çš„ç¤ºèŒƒï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œå› ä¸º GPU ä»¿çœŸä¼šä¸ CPU ä»¿çœŸ         â”‚
â”‚     ä½¿ç”¨ç›¸åŒç§å­æ—¶éšæœºåŒ–åˆå§‹çŠ¶æ€ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                          â”‚
â”‚ --count {None}|INT                                                         â”‚
â”‚     åœ¨é€€å‡ºä¹‹å‰å›æ”¾çš„ç¤ºèŒƒæ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†å›æ”¾æ‰€æœ‰ç¤ºèŒƒã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰   â”‚
â”‚ --reward-mode {None}|STR                                                   â”‚
â”‚     æŒ‡å®šç¯å¢ƒåº”ä½¿ç”¨çš„å¥–åŠ±ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹å°†é€‰æ‹©ç¬¬ä¸€ä¸ªæ”¯æŒçš„å¥–åŠ±æ¨¡å¼ã€‚å¤§å¤šæ•° â”‚
â”‚     ç¯å¢ƒæ”¯æŒ 'sparse'ã€'none'ï¼Œæœ‰äº›ç¯å¢ƒè¿˜æ”¯æŒ 'normalized_dense' å’Œ       â”‚
â”‚     'dense' å¥–åŠ±æ¨¡å¼ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                       â”‚
â”‚ --record-rewards, --no-record-rewards                                      â”‚
â”‚     æ˜¯å¦åœ¨å›æ”¾çš„è½¨è¿¹ä¸­åŒ…å«å¥–åŠ±ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                           â”‚
â”‚ --shader {None}|STR                                                        â”‚
â”‚     æ›´æ”¹æ‰€æœ‰æ‘„åƒæœºæ¸²æŸ“ä½¿ç”¨çš„ç€è‰²å™¨ã€‚é»˜è®¤å€¼ä¸º noneï¼Œå³ä½¿ç”¨åŸå§‹æ•°æ®æ”¶é›†æ—¶ â”‚
â”‚     ä½¿ç”¨çš„ç€è‰²å™¨æˆ–ç¯å¢ƒé»˜è®¤ç€è‰²å™¨ã€‚ä¹Ÿå¯ä»¥è®¾ç½®ä¸º 'rt' æ¥å¯ç”¨å…‰çº¿è¿½è¸ªï¼Œç”Ÿæˆ â”‚
â”‚     ç…§ç‰‡çº§é€¼çœŸæ¸²æŸ“ã€‚è¿˜å¯ä»¥è®¾ç½®ä¸º 'rt-fast' æ¥å¯ç”¨æ›´å¿«ä½†è´¨é‡è¾ƒä½çš„å…‰çº¿è¿½è¸ª â”‚
â”‚     æ¸²æŸ“å™¨ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                  â”‚
â”‚ --video-fps {None}|INT                                                     â”‚
â”‚     ä¿å­˜è§†é¢‘çš„å¸§ç‡ã€‚é»˜è®¤ä¸ºæ§åˆ¶é¢‘ç‡ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                         â”‚
â”‚ --render-mode STR                                                          â”‚
â”‚     ä¿å­˜è§†é¢‘æ—¶ä½¿ç”¨çš„æ¸²æŸ“æ¨¡å¼ã€‚é€šå¸¸è¿˜æœ‰ 'sensors' å’Œ 'all' æ¸²æŸ“æ¨¡å¼ï¼Œ      â”‚
â”‚     å¯ä»¥æ¸²æŸ“æ‰€æœ‰ä¼ æ„Ÿå™¨è¾“å‡ºï¼Œå¦‚æ‘„åƒå¤´ã€‚ï¼ˆé»˜è®¤ï¼šrgb_arrayï¼‰                  â”‚
â”‚ -n INT, --num-envs INT                                                     â”‚
â”‚     ç”¨äºå›æ”¾è½¨è¿¹çš„ç¯å¢ƒæ•°é‡ã€‚å¯¹äº CPU åç«¯ï¼Œé€šå¸¸é€šè¿‡ Python å¤šè¿›ç¨‹å¹¶è¡ŒåŒ–ã€‚   â”‚
â”‚     å¯¹äºåƒ physx_gpu è¿™æ ·çš„å¹¶è¡Œä»¿çœŸåç«¯ï¼Œé€šå¸¸é€šè¿‡åœ¨å•ä¸ª Python è¿›ç¨‹ä¸­åˆ©ç”¨ â”‚
â”‚     GPU å¹¶è¡ŒåŒ–ã€‚ï¼ˆé»˜è®¤ï¼š1ï¼‰                                                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ä¸‹é¢çš„è¡¨æ ¼åˆ—å‡ºäº†æ—§ç‰ˆæœ¬ä¸æ–°ç‰ˆæœ¬ä¸­å„ä¸ªå‚æ•°çš„å¯¹æ¯”æƒ…å†µï¼š

| å‚æ•°                                                    | æ—§ç‰ˆæœ¬æè¿°                                                                            | æ–°ç‰ˆæœ¬æè¿°                            | å¤‡æ³¨           |
| ----------------------------------------------------- | -------------------------------------------------------------------------------- | -------------------------------- | ------------ |
| **--traj-path STR**                                   | éœ€è¦å›æ”¾çš„è½¨è¿¹ .h5 æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰                                                             | éœ€è¦å›æ”¾çš„è½¨è¿¹ .h5 æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰             | æ— å˜åŒ–          |
| **--sim-backend {None}\|STR, -b {None}\|STR**         | ä½¿ç”¨çš„ä»¿çœŸåç«¯ï¼Œå¯é€‰ 'physx_cpu' æˆ– 'physx_gpu'ã€‚æœªæŒ‡å®šæ—¶é»˜è®¤ä½¿ç”¨æ”¶é›†è½¨è¿¹æ—¶ä½¿ç”¨çš„åç«¯ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--obs-mode {None}\|STR, -o {None}\|STR**            | ç›®æ ‡è§‚å¯Ÿæ¨¡å¼ï¼Œç”¨äºè®°å½•è½¨è¿¹ä¸­çš„è§‚å¯Ÿæ•°æ®ã€‚å‚è§æ–‡æ¡£è·å–æ”¯æŒçš„è§‚å¯Ÿæ¨¡å¼åˆ—è¡¨ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                    | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--target-control-mode {None}\|STR, -c {None}\|STR** | ç›®æ ‡æ§åˆ¶æ¨¡å¼ï¼Œç”¨äºå°†ç¤ºèŒƒåŠ¨ä½œè½¬æ¢ä¸ºå…¶ä»–æ§åˆ¶æ¨¡å¼ã€‚æ³¨æ„ä¸æ˜¯æ‰€æœ‰æ§åˆ¶æ¨¡å¼éƒ½èƒ½æˆåŠŸè½¬æ¢ï¼Œç›®å‰ Panda æœºå™¨äººæ”¯æŒæœ€ä½³ï¼›GPU ç¯å¢ƒä¸‹ä¸æ”¯æŒè½¬æ¢ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰ | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--verbose, --no-verbose**                           | æ˜¯å¦åœ¨è½¨è¿¹é‡æ’­è¿‡ç¨‹ä¸­æ‰“å°è¯¦ç»†ä¿¡æ¯ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                      | æ˜¯å¦åœ¨å›æ”¾è½¨è¿¹æ—¶æ‰“å°è¯¦ç»†ä¿¡æ¯ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰        | æè¿°ç•¥æœ‰ä¸åŒï¼Œä½†åŠŸèƒ½ç›¸åŒ |
| **--save-traj, --no-save-traj**                       | æ˜¯å¦ä¿å­˜è½¨è¿¹åˆ°ç£ç›˜ï¼Œä¸ä¼šè¦†ç›–åŸå§‹è½¨è¿¹æ–‡ä»¶ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                  | æ˜¯å¦å°†è½¨è¿¹ä¿å­˜åˆ°ç£ç›˜ï¼Œä¸ä¼šè¦†ç›–åŸå§‹è½¨è¿¹æ–‡ä»¶ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰ | æ— å˜åŒ–          |
| **--save-video, --no-save-video**                     | æ˜¯å¦ä¿å­˜è§†é¢‘ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                                | æ˜¯å¦ä¿å­˜è§†é¢‘ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                | æ— å˜åŒ–          |
| **--num-procs INT**                                   | ç”¨äºå¹¶è¡ŒåŒ–è½¨è¿¹é‡æ’­è¿‡ç¨‹çš„è¿›ç¨‹æ•°ã€‚CPU åç«¯é€šè¿‡ Python å¤šè¿›ç¨‹å¹¶è¡Œï¼›physx_gpu åç«¯åœ¨å•è¿›ç¨‹å†…åˆ©ç”¨ GPU å¹¶è¡ŒåŒ–ã€‚ï¼ˆé»˜è®¤ï¼š1ï¼‰         | **å·²åˆ é™¤**                          | æ–°ç‰ˆæœ¬ä¸­ç§»é™¤äº†è¯¥å‚æ•°   |
| **--max-retry INT**                                   | å›æ”¾è½¨è¿¹æ—¶æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç›´åˆ°ä»»åŠ¡åœ¨ç»“æŸæ—¶è¾¾åˆ°æˆåŠŸçŠ¶æ€ã€‚ï¼ˆé»˜è®¤ï¼š0ï¼‰                                                | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--discard-timeout, --no-discard-timeout**           | æ˜¯å¦ä¸¢å¼ƒè¶…æ—¶å¹¶è¢«æˆªæ–­çš„å›åˆï¼ˆå–å†³äºä»»åŠ¡çš„ max_episode_steps å‚æ•°ï¼‰ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                            | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--allow-failure, --no-allow-failure**               | æ˜¯å¦åœ¨ä¿å­˜çš„è§†é¢‘å’Œè½¨è¿¹æ•°æ®ä¸­åŒ…å«å¤±è´¥çš„å›åˆï¼Œä¾æ®ç¯å¢ƒè¯„ä¼°è¿”å›çš„ "success" æ ‡ç­¾å†³å®šã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                        | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--vis, --no-vis**                                   | æ˜¯å¦é€šè¿‡ GUI å¯è§†åŒ–è½¨è¿¹é‡æ’­ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                      | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--use-env-states, --no-use-env-states**             | æ˜¯å¦ä½¿ç”¨ç¯å¢ƒçŠ¶æ€è€ŒéåŠ¨ä½œè¿›è¡Œå›æ”¾ï¼Œä¿è¯ç¯å¢ƒåœ¨æ¯ä¸€æ­¥ä¸åŸå§‹è½¨è¿¹ä¸€è‡´ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                      | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--use-first-env-state, --no-use-first-env-state**   | æ˜¯å¦ä½¿ç”¨è½¨è¿¹ä¸­çš„ç¬¬ä¸€ä¸ªç¯å¢ƒçŠ¶æ€ä½œä¸ºåˆå§‹çŠ¶æ€ï¼Œç”¨äºåœ¨ GPU ä»¿çœŸä¸­é‡æ’­ CPU æ”¶é›†çš„ç¤ºèŒƒã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                         | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--count {None}\|INT**                               | åœ¨é€€å‡ºå‰å›æ”¾çš„ç¤ºèŒƒæ•°é‡ï¼Œé»˜è®¤å›æ”¾æ‰€æœ‰ç¤ºèŒƒã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                   | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--reward-mode {None}\|STR**                         | æŒ‡å®šç¯å¢ƒä½¿ç”¨çš„å¥–åŠ±ç±»å‹ï¼Œå¤§å¤šæ•°ç¯å¢ƒæ”¯æŒ 'sparse'ã€'none'ï¼Œéƒ¨åˆ†æ”¯æŒ 'normalized_dense' å’Œ 'dense'ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰  | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--record-rewards, --no-record-rewards**             | æ˜¯å¦åœ¨å›æ”¾è½¨è¿¹ä¸­åŒ…å«å¥–åŠ±ã€‚ï¼ˆé»˜è®¤ï¼šFalseï¼‰                                                          | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--shader {None}\|STR**                              | æ›´æ”¹æ‰€æœ‰æ‘„åƒæœºæ¸²æŸ“ä½¿ç”¨çš„ç€è‰²å™¨ã€‚é»˜è®¤ä½¿ç”¨åŸå§‹æ•°æ®æ”¶é›†æ—¶æˆ–ç¯å¢ƒé»˜è®¤çš„ç€è‰²å™¨ï¼›å¯é€‰ 'rt'ï¼ˆå…‰çº¿è¿½è¸ªï¼‰æˆ– 'rt-fast'ï¼ˆå¿«é€Ÿå…‰çº¿è¿½è¸ªï¼‰ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰  | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--video-fps {None}\|INT**                           | ä¿å­˜è§†é¢‘çš„å¸§ç‡ï¼Œé»˜è®¤ä¸ºæ§åˆ¶é¢‘ç‡ã€‚ï¼ˆé»˜è®¤ï¼šNoneï¼‰                                                        | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--render-mode STR**                                 | ä¿å­˜è§†é¢‘æ—¶ä½¿ç”¨çš„æ¸²æŸ“æ¨¡å¼ï¼Œæ”¯æŒ 'rgb_array'ã€'sensors'ã€'all' ç­‰æ¨¡å¼ï¼Œåä¸¤è€…å¯æ¸²æŸ“æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®ã€‚ï¼ˆé»˜è®¤ï¼šrgb_arrayï¼‰     | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |
| **--num-envs INT, -n INT**                            | ç”¨äºå›æ”¾è½¨è¿¹çš„ç¯å¢ƒæ•°é‡ã€‚CPU åç«¯é€šè¿‡ Python å¤šè¿›ç¨‹å¹¶è¡Œï¼›physx_gpu åç«¯åœ¨å•è¿›ç¨‹å†…åˆ©ç”¨ GPU å¹¶è¡ŒåŒ–ã€‚ï¼ˆé»˜è®¤ï¼š1ï¼‰             | åŒæ—§ç‰ˆæœ¬æè¿°                           | æ— å˜åŒ–          |

é€šè¿‡ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼Œæœ€æ–°ç‰ˆæœ¬ä¸»è¦ç§»é™¤äº† **--num-procs** å‚æ•°ï¼Œå…¶ä½™å„å‚æ•°åŠå…¶åŠŸèƒ½åŸºæœ¬ä¿æŒä¸€è‡´ã€‚

:::

:::{caution}
ç”±äºæŸäº›æ¼”ç¤ºæ˜¯ä»¥éå‡†é™æ€æ–¹å¼æ”¶é›†çš„ï¼ˆåœ¨æ“ä½œè¿‡ç¨‹ä¸­ç‰©ä½“æ²¡æœ‰å›ºå®šåœ¨æ“çºµå™¨ä¸Šï¼‰æˆ–æŸäº›å…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ PushT-v1 æˆ– PickSingleYCB-v1ï¼‰éœ€è¦é«˜ç²¾åº¦ï¼Œå› æ­¤ï¼Œç”±äºä»¿çœŸä¸­çš„éç¡®å®šæ€§ï¼Œé‡æ’­åŠ¨ä½œ/è½¬æ¢åŠ¨ä½œå¯èƒ½ä¼šå¤±è´¥ã€‚å› æ­¤ï¼Œé€šè¿‡ä¼ é€’ `--use-env-states` æ¥é‡æ’­è½¨è¿¹å¹¶ç¡®ä¿é‡æ’­çš„çŠ¶æ€/è§‚å¯Ÿæ•°æ®ä¸åŸå§‹è½¨è¿¹ç›¸åŒæ˜¯å¿…éœ€çš„ã€‚
:::

## ç¤ºä¾‹ç”¨æ³•

ç”±äºè½¨è¿¹é‡æ’­å·¥å…·åŠŸèƒ½ä¸°å¯Œä¸”å¤æ‚ï¼Œæˆ‘ä»¬å»ºè®®å‡ ä¸ªç¤ºä¾‹å·¥ä½œæµç¨‹ï¼Œé€‚ç”¨äºå„ç§ç”¨ä¾‹ã€‚

### å°†è½¨è¿¹ä»ä¸€ä¸ªæ§åˆ¶æ¨¡å¼é‡æ’­åˆ°æ›´æ˜“å­¦ä¹ çš„æ§åˆ¶æ¨¡å¼

åœ¨æœºå™¨å­¦ä¹ å·¥ä½œæµä¸­ï¼Œæœ‰æ—¶ä»ä¸€äº›æ§åˆ¶æ¨¡å¼ï¼ˆä¾‹å¦‚æœ«ç«¯æ‰§è¡Œå™¨æ§åˆ¶æ¨¡å¼ï¼‰ä¸­å­¦ä¹ ä¼šæ›´å®¹æ˜“ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ­£æ˜¯è¿™æ ·åšçš„ï¼š

```bash
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path path/to/trajectory.h5 \
  -c pd_ee_delta_pose -o state \
  --save-traj
```

è¯·æ³¨æ„ï¼Œç”±äºæ§åˆ¶å™¨å’Œæ¼”ç¤ºè¡Œä¸ºçš„å›ºæœ‰å·®å¼‚ï¼Œä¸€äº›ç›®æ ‡æ§åˆ¶æ¨¡å¼å¯èƒ½å¾ˆéš¾è½¬æ¢ã€‚

1. **PickCube-v1ä»»åŠ¡**ï¼šè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ä»»åŠ¡ï¼Œé€‚åˆåˆæ­¥æµ‹è¯•
   
   - `~/.maniskill/demos/PickCube-v1/rl/trajectory.none.pd_joint_delta_pos.physx_cuda.h5`ï¼ˆæºæ§åˆ¶æ¨¡å¼ï¼šå…³èŠ‚æ§åˆ¶ï¼‰
   - è½¬æ¢ç›®æ ‡ï¼š`pd_ee_delta_pose`ï¼ˆæœ«ç«¯æ‰§è¡Œå™¨å§¿æ€æ§åˆ¶ï¼‰

2. **PushCube-v1ä»»åŠ¡**ï¼šè¿™æ˜¯ä¸€ä¸ªæ¨ç®±å­çš„ä»»åŠ¡ï¼ŒåŠ¨ä½œç›¸å¯¹ç®€å•
   
   - `~/.maniskill/demos/PushCube-v1/rl/trajectory.none.pd_joint_delta_pos.physx_cuda.h5`ï¼ˆæºæ§åˆ¶æ¨¡å¼ï¼šå…³èŠ‚æ§åˆ¶ï¼‰
   - è½¬æ¢ç›®æ ‡ï¼š`pd_ee_delta_pos`ï¼ˆæœ«ç«¯æ‰§è¡Œå™¨ä½ç½®æ§åˆ¶ï¼‰

3. **StackCube-v1ä»»åŠ¡**ï¼šè¿™æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„å †å ä»»åŠ¡ï¼Œéœ€è¦æ›´ç²¾ç¡®çš„æ§åˆ¶
   
   - `~/.maniskill/demos/StackCube-v1/rl/trajectory.none.pd_ee_delta_pos.physx_cuda.h5`ï¼ˆæºæ§åˆ¶æ¨¡å¼ï¼šæœ«ç«¯æ‰§è¡Œå™¨ä½ç½®æ§åˆ¶ï¼‰
   - è½¬æ¢ç›®æ ‡ï¼š`pd_ee_delta_pose`ï¼ˆæœ«ç«¯æ‰§è¡Œå™¨å§¿æ€æ§åˆ¶ï¼‰

è¦æŸ¥çœ‹æµ‹è¯•æ•ˆæœï¼Œä½ å¯ä»¥ï¼š

1. **è§‚å¯Ÿç”Ÿæˆçš„è½¨è¿¹æ–‡ä»¶**ï¼šé‡æ’­åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ h5 æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸­åŒ…å«ç›®æ ‡æ§åˆ¶æ¨¡å¼
2. **æŸ¥çœ‹ç”Ÿæˆçš„è§†é¢‘**ï¼šä½¿ç”¨ `--render-mode rgb_array --render-camera third_view --replay-render` å‚æ•°å¯ä»¥ç”Ÿæˆé‡æ’­è§†é¢‘
3. **æ¯”è¾ƒå‰åçš„è½¨è¿¹**ï¼šå¯ä»¥æ¯”è¾ƒåŸå§‹è½¨è¿¹å’Œé‡æ’­è½¨è¿¹çš„ MP4 è§†é¢‘ï¼Œçœ‹æœºå™¨äººçš„è¡Œä¸ºæ˜¯å¦ç›¸ä¼¼

æˆ‘æ¨èä» **PickCube-v1** ä»»åŠ¡å¼€å§‹æµ‹è¯•ï¼Œå› ä¸ºå®ƒæ˜¯æœ€åŸºç¡€çš„æ‹¾å–ä»»åŠ¡ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/rl/trajectory.none.pd_joint_delta_pos.physx_cuda.h5 \
  -c pd_ee_delta_pose -o state \
  --render-mode rgb_array --render-camera third_view --replay-render \
  --save-traj
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š

1. è¯»å–æºè½¨è¿¹æ–‡ä»¶ï¼ˆå…³èŠ‚æ§åˆ¶æ¨¡å¼ï¼‰
2. é‡æ’­åˆ°æœ«ç«¯æ‰§è¡Œå™¨å§¿æ€æ§åˆ¶æ¨¡å¼
3. ä¿å­˜æ–°çš„è½¨è¿¹æ–‡ä»¶
4. ç”Ÿæˆé‡æ’­è§†é¢‘

æ‰§è¡Œåï¼Œä½ å¯ä»¥æ¯”è¾ƒ `sample_pd_joint_delta_pos.mp4` å’Œæ–°ç”Ÿæˆçš„è§†é¢‘æ–‡ä»¶ï¼ŒæŸ¥çœ‹æœºå™¨äººåœ¨ä¸åŒæ§åˆ¶æ¨¡å¼ä¸‹çš„è¡¨ç°å·®å¼‚ã€‚

ä½†æ˜¯ï¼Œå¦‚æœé‡åˆ°ç›¸å…³æœ€å¤§æ­¥æ•°çš„æŠ¥é”™ï¼Œè®°å¾—ä¿®æ”¹

![](assets/2025-03-22-09-42-38-image.png)

ManiSkill çš„æ§åˆ¶æ¨¡å¼è½¬æ¢æœ‰ä¸€äº›é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯ï¼š

1. ä» `pd_joint_delta_pos` åªèƒ½è½¬æ¢ä¸º `pd_joint_pos`
2. ä» `pd_joint_pos` å¯ä»¥è½¬æ¢ä¸ºæœ«ç«¯æ‰§è¡Œå™¨æ§åˆ¶ï¼ˆ`pd_ee_delta_pose` ç­‰ï¼‰

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸¤æ­¥è½¬æ¢ï¼š

1. é¦–å…ˆä» `pd_joint_delta_pos` è½¬æ¢ä¸º `pd_joint_pos`
2. ç„¶åä» `pd_joint_pos` è½¬æ¢ä¸º `pd_ee_delta_pose`

ä»¥ä¸‹æ˜¯è§£å†³æ–¹æ¡ˆï¼š

```bash
# ç¬¬ä¸€æ­¥ï¼šè½¬æ¢ä¸º pd_joint_pos
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/rl/trajectory.none.pd_joint_delta_pos.physx_cuda.h5 \
  --target-control-mode pd_joint_pos \
  --obs-mode state \
  --render-mode rgb_array \
  --save-traj \
  --sim-backend physx_cpu \
  --num-envs 1

# ç¬¬äºŒæ­¥ï¼šä» pd_joint_pos è½¬æ¢ä¸º pd_ee_delta_pose
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/rl/trajectory.state.pd_joint_pos.physx_cpu.h5 \
  --target-control-mode pd_ee_delta_pose \
  --obs-mode state \
  --render-mode rgb_array \
  --save-traj \
  --save-video \
  --video-fps 30 \
  --sim-backend physx_cpu \
  --num-envs 1
```

å¦å¤–ï¼Œå¦‚æœæƒ³æŸ¥çœ‹ä»£ç ä¸­æ”¯æŒçš„è½¬æ¢è·¯å¾„ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ `utils/actions/conversion.py` æ–‡ä»¶ã€‚æ ¹æ®æˆ‘ä»¬çš„æŸ¥çœ‹ï¼ŒManiSkill æ”¯æŒçš„è½¬æ¢è·¯å¾„ä¸»è¦æœ‰ï¼š

1. `pd_joint_pos` â†’ `pd_ee_delta_pose`ï¼ˆé€šè¿‡ `from_pd_joint_pos_to_ee` å‡½æ•°ï¼‰
2. `pd_joint_delta_pos` â†’ `pd_joint_pos`ï¼ˆé€šè¿‡ `from_pd_joint_delta_pos` å‡½æ•°ï¼‰ 

### å‘è½¨è¿¹ä¸­æ·»åŠ å¥–åŠ±/è§‚å¯Ÿæ•°æ®

ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œæ¼”ç¤ºé€šå¸¸ä¸åŒ…å«è§‚å¯Ÿæ•°æ®å’Œå¥–åŠ±ã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å°†å¥–åŠ±ã€RGB è§‚å¯Ÿæ•°æ®å’Œæ ‡å‡†åŒ–çš„å¯†é›†å¥–åŠ±ï¼ˆå‡è®¾ç¯å¢ƒæ”¯æŒå¯†é›†å¥–åŠ±ï¼‰é‡æ–°æ·»åŠ åˆ°è½¨è¿¹ä¸­ã€‚`--use-env-states` ä½œä¸ºç¡®ä¿é‡æ’­çš„çŠ¶æ€/è§‚å¯Ÿæ•°æ®ä¸åŸå§‹è½¨è¿¹å®Œå…¨ç›¸åŒçš„æ–¹å¼è¢«æ·»åŠ ã€‚

```bash
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path path/to/trajectory.h5 \
  --record-rewards --reward-mode="normalized_dense" -o rgb \
  --use-env-states \
  --save-traj
ä¾‹å¦‚ï¼š
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/motionplanning/trajectory.h5 \
  --record-rewards --reward-mode="normalized_dense" -o rgb \
  --use-env-states \
  --save-traj \
  --sim-backend physx_cpu \
  --num-envs 1
```

![](assets/2025-03-22-09-52-48-image.png)

è¿™ä¸ªå°±æ˜¯åˆšåˆšç”Ÿæˆçš„æ–‡ä»¶

ç„¶åæ˜¯å¯è§†åŒ–ç¯èŠ‚

```
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PickCube-v1/motionplanning/trajectory.rgb.none.physx_cpu.h5 \
  --vis \
  --sim-backend physx_cpu \
  --num-envs 1
```

![](assets/2025-03-22-10-12-04-image.png) 

å…¶å®å°±æ˜¯ç”Ÿæˆè¿™ä¸ªç»¿è‰²çš„ç‚¹ 

### åœ¨ CPU/GPU ä»¿çœŸä¸­é‡æ’­ä» CPU/GPU ä»¿çœŸæ”¶é›†çš„è½¨è¿¹

æŸäº›æ¼”ç¤ºå¯èƒ½æ˜¯åœ¨ CPU ä»¿çœŸä¸­æ”¶é›†çš„ï¼Œä½†å¸Œæœ›å®ƒä»¬èƒ½å¤Ÿåœ¨ GPU ä»¿çœŸä¸­ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚ç”±äº CPU å’Œ GPU ä»¿çœŸåœ¨ç»™å®šç›¸åŒåŠ¨ä½œå’Œåˆå§‹çŠ¶æ€æ—¶ä¼šæœ‰ç•¥å¾®ä¸åŒçš„è¡Œä¸ºï¼Œéœ€è¦ç¡®ä¿æ¼”ç¤ºå¯ä»¥è¢«å­¦ä¹ ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨é¥æ“ä½œæ”¶é›†æ¼”ç¤ºï¼Œè¿™äº›æ¼”ç¤ºé€šå¸¸ä¼šåœ¨ CPU ä»¿çœŸä¸­æ”¶é›†ï¼Œä»¥ä¾¿æä¾›æ›´å¤§çš„çµæ´»æ€§å’Œæ›´é«˜çš„å•çº¿ç¨‹é€Ÿåº¦ã€‚ç„¶è€Œï¼Œæ¨¡ä»¿/å¼ºåŒ–å­¦ä¹ å·¥ä½œæµå¯èƒ½ä¼šåœ¨ GPU ä»¿çœŸä¸­è¿›è¡Œè®­ç»ƒã€‚ä¸ºäº†ç¡®ä¿å¯ä»¥ä»æ¼”ç¤ºä¸­å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬é‡æ’­åˆ° GPU ä»¿çœŸä¸­ï¼Œå¹¶ä¿å­˜é‚£äº›æˆåŠŸé‡æ’­çš„æ¼”ç¤ºã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ç¬¬ä¸€ä¸ªç¯å¢ƒçŠ¶æ€ã€å¼ºåˆ¶ä½¿ç”¨ GPU ä»¿çœŸï¼ˆ`-b "physx_cuda"`ï¼‰å¹¶è®¾ç½®æ‰€éœ€çš„æ§åˆ¶å’Œè§‚å¯Ÿæ¨¡å¼æ¥å®ç°çš„ã€‚

```bash
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path path/to/trajectory.h5 \
  --use-first-env-state -b "physx_cuda" \
  -c pd_joint_delta_pos -o state \
  --save-traj

ä¾‹å¦‚
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PushCube-v1/motionplanning/trajectory.h5 \
  --use-first-env-state -b "physx_cuda" \
  -c pd_joint_delta_pos -o state \
  --save-traj

ç”Ÿæˆ
~/.maniskill/demos/PushCube-v1/motionplanning/trajectory.state.pd_joint_delta_pos.physx_cuda.h5

å¯è§†åŒ–
python -m mani_skill.trajectory.replay_trajectory \
  --traj-path ~/.maniskill/demos/PushCube-v1/motionplanning/trajectory.state.pd_joint_delta_pos.physx_cuda.h5 \
  --vis
```
